<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BIM Engine SDK Demo</title>
    <!-- ä»æœ¬åœ° lib ç›®å½•åŠ è½½ SDK æ–‡ä»¶ -->
    <script src="./lib/bim-engine-sdk.umd.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            height: 100vh;
            display: flex;
            overflow: hidden;
            /* é˜²æ­¢æ•´ä¸ªé¡µé¢æ»šåŠ¨ */
        }

        /* å·¦ä¾§ä¾§è¾¹æ ï¼šæ§åˆ¶é¢æ¿ */
        .sidebar {
            width: 320px;
            background: white;
            border-right: 1px solid #e0e0e0;
            padding: 20px;
            overflow-y: auto;
            /* å†…å®¹è¿‡å¤šæ—¶å¯æ»šåŠ¨ */
            display: flex;
            flex-direction: column;
            gap: 20px;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.05);
            z-index: 10;
        }

        .sidebar h1 {
            font-size: 1.4rem;
            color: #333;
            margin-bottom: 10px;
        }

        .control-group {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #eee;
        }

        .control-group h2 {
            font-size: 1rem;
            color: #555;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 2px solid #e0e0e0;
        }

        .btn-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        button {
            padding: 6px 12px;
            font-size: 0.9rem;
            border: 1px solid #ddd;
            background: #fff;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            flex: 1 1 auto;
            /* æŒ‰é’®è‡ªåŠ¨å¡«å…… */
        }

        button:hover {
            background: #f0f0f0;
            border-color: #ccc;
        }

        button.primary {
            background: #0078d4;
            color: white;
            border-color: #0063b1;
        }

        button.primary:hover {
            background: #0063b1;
        }

        /* å³ä¾§ä¸»å†…å®¹åŒºï¼šå¼•æ“å±•ç¤º */
        .main-content {
            flex: 1;
            position: relative;
            background: #eef2f5;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #app {
            width: 100%;
            height: 100%;
            background: #fff;
            position: relative;
        }
    </style>
</head>

<body>
    <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ -->
    <aside class="sidebar">
        <h1>BIM SDK Demo</h1>

        <!-- 1. è¯­è¨€è®¾ç½® -->
        <div class="control-group">
            <h2>ğŸŒ è¯­è¨€ (Language)</h2>
            <div class="btn-container">
                <button class="primary" onclick="setLang('zh-CN')">ä¸­æ–‡</button>
                <button class="primary" onclick="setLang('en-US')">English</button>
            </div>
        </div>

        <!-- 2. å¼¹çª—æµ‹è¯• -->
        <div class="control-group">
            <h2>ğŸªŸ å¼¹çª— (Dialog)</h2>
            <div class="btn-container">
                <button onclick="openTestDialog()">æµ‹è¯•å¼¹çª—</button>
                <button onclick="openInfoDialog()">ä¿¡æ¯å¼¹çª—</button>
                <button onclick="openRedDialog()">è­¦å‘Šå¼¹çª—</button>
            </div>
        </div>

        <!-- 3. å·¥å…·æ æ“ä½œ -->
        <div class="control-group">
            <h2>ğŸ› ï¸ å·¥å…·æ  (Toolbar)</h2>
            <div class="btn-container">
                <button onclick="toggleToolbar()">æ˜¾éšå·¥å…·æ </button>
                <button onclick="toggleLabel()">æ˜¾éšæ ‡ç­¾</button>
                <button onclick="toggleLocationBtn()">æ˜¾éšå®šä½æŒ‰é’®</button>
            </div>
            <div class="btn-container" style="margin-top: 8px;">
                <button onclick="addCustomGroup()">åŠ ç»„</button>
                <button onclick="addCustomButton()">åŠ æŒ‰é’®</button>
            </div>
        </div>

        <!-- 4. æ ·å¼ä¸»é¢˜ -->
        <div class="control-group">
            <h2>ğŸ¨ æ ·å¼ (Theme)</h2>
            <div class="btn-container">
                <button onclick="setTheme('dark')">æ·±è‰² (Dark)</button>
                <button onclick="setTheme('light')">æµ…è‰² (Light)</button>
                <button onclick="setCustomTheme()">è‡ªå®šä¹‰ (Red)</button>
            </div>
        </div>

        <!-- 5. 3D å¼•æ“ -->
        <div class="control-group">
            <h2>ğŸ® 3D å¼•æ“ (Engine3D)</h2>
            <div class="btn-container">
                <button class="primary" onclick="initEngine3D()">åˆå§‹åŒ–å¼•æ“</button>
                <button class="primary" onclick="loadModel()">åŠ è½½æ¨¡å‹</button>
            </div>
            <div style="margin-top: 10px; font-size: 0.85rem; color: #666;">
                <div>çŠ¶æ€: <span id="engine-status">æœªåˆå§‹åŒ–</span></div>
            </div>
        </div>
    </aside>

    <!-- å³ä¾§ä¸»åŒºåŸŸ -->
    <main class="main-content">
        <div id="app"></div>
    </main>

    <script>
        let engine = null;
        let isToolbarVisible = true;
        let isLabelVisible = true;
        let isLocationVisible = true;
        let customGroupAdded = false;
        let engine3DInitialized = false;

        // åˆå§‹åŒ–å¼•æ“
        window.onload = () => {
            if (window.LyzBimEngineSDK) {
                const Engine = window.LyzBimEngineSDK.BimEngine;
                try {
                    engine = new Engine('app', { locale: 'zh-CN' });
                    // initEngine3D();
                    console.log('Engine initialized:', engine);
                } catch (err) {
                    console.error('Init failed:', err);
                }
            } else {
                console.error('SDK not found');
            }
        };

        // --- è¯­è¨€è®¾ç½® ---
        function setLang(lang) {
            if (engine) engine.setLocale(lang);
        }

        // --- å¼¹çª—æµ‹è¯• ---
        function openTestDialog() {
            if (!engine || !engine.dialog) return;
            engine.dialog.create({
                title: 'dialog.testTitle',
                width: 350,
                height: 200,
                position: 'center',
                draggable: true,
                resizable: true
            });
        }

        function openInfoDialog() {
            if (!engine || !engine.dialog) return;
            engine.dialog.showInfoDialog();
        }

        function openRedDialog() {
            if (!engine || !engine.dialog) return;
            engine.dialog.create({
                title: 'Alert',
                content: '<div style="color: #ffcccc;">Critical Warning!</div>',
                width: 300,
                height: 150,
                backgroundColor: 'rgba(100, 0, 0, 0.95)',
                headerBackgroundColor: '#cc0000',
                titleColor: '#ffffff',
                borderColor: '#ff6666',
                position: { x: 50, y: 50 }
            });
        }

        // --- å·¥å…·æ æ“ä½œ ---
        function toggleToolbar() {
            if (!engine || !engine.toolbar) return;
            isToolbarVisible = !isToolbarVisible;
            engine.toolbar.setVisible(isToolbarVisible);
        }

        function toggleLabel() {
            if (!engine || !engine.toolbar) return;
            isLabelVisible = !isLabelVisible;
            engine.toolbar.setShowLabel(isLabelVisible);
        }

        function toggleLocationBtn() {
            if (!engine || !engine.toolbar) return;
            isLocationVisible = !isLocationVisible;
            engine.toolbar.setButtonVisibility('location', isLocationVisible);
        }

        function addCustomGroup() {
            if (!engine || !engine.toolbar) return;
            if (customGroupAdded) {
                alert('å·²æ·»åŠ è¿‡');
                return;
            }
            engine.toolbar.addGroup('custom-group', 'group-1');
            customGroupAdded = true;
        }

        function addCustomButton() {
            if (!engine || !engine.toolbar) return;
            if (!customGroupAdded) {
                alert('Please add custom group first / è¯·å…ˆæ·»åŠ è‡ªå®šä¹‰ç»„');
                return;
            }
            const btnId = 'custom-btn-' + Date.now();
            engine.toolbar.addButton({
                id: btnId,
                groupId: 'custom-group',
                type: 'button',
                label: 'New',
                icon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg>',
                onClick: (btn) => {
                    alert('Clicked: ' + btn.label);
                }
            });
        }

        // --- ä¸»é¢˜æ“ä½œ ---
        function setTheme(themeName) {
            if (engine) engine.setTheme(themeName);
        }

        function setCustomTheme() {
            if (!engine) return;
            // å®šä¹‰ä¸€ä¸ªçº¢è‰²ä¸»é¢˜
            engine.setCustomTheme({
                name: 'red-alert',
                primary: '#d32f2f',
                primaryHover: '#b71c1c',

                background: '#ffebee', // æµ…çº¢èƒŒæ™¯
                panelBackground: 'rgba(255, 255, 255, 0.9)',

                textPrimary: '#b71c1c',
                textSecondary: '#e57373',

                border: '#ffcdd2',

                icon: '#d32f2f',
                iconActive: '#b71c1c',

                componentBackground: 'rgba(255, 205, 210, 0.3)',
                componentHover: 'rgba(255, 205, 210, 0.8)',
                componentActive: '#e57373'
            });
        }

        // --- 3D å¼•æ“æ“ä½œ ---
        /**
         * åˆå§‹åŒ– 3D å¼•æ“
         */
        function initEngine3D() {
            if (!engine || !engine.engine) {
                alert('å¼•æ“æœªåˆ›å»ºï¼Œè¯·å…ˆç­‰å¾…é¡µé¢åŠ è½½å®Œæˆ');
                return;
            }

            if (engine.engine.isInitialized()) {
                alert('3D å¼•æ“å·²ç»åˆå§‹åŒ–è¿‡äº†');
                updateEngineStatus('å·²åˆå§‹åŒ–');
                return;
            }

            try {
                // åˆå§‹åŒ–å¼•æ“ï¼Œä½¿ç”¨é»˜è®¤é…ç½®
                const success = engine.initEngine({
                    backgroundColor: 0x333333,  // æ·±è‰²èƒŒæ™¯
                    version: 'v1',               // WebGL ç‰ˆæœ¬
                    showStats: true,             // æ˜¾ç¤ºæ€§èƒ½ç»Ÿè®¡
                    showViewCube: true           // æ˜¾ç¤ºè§†å›¾ç«‹æ–¹ä½“
                });

                if (success) {
                    engine3DInitialized = true;
                    updateEngineStatus('å·²åˆå§‹åŒ–');
                    console.log('âœ… 3D å¼•æ“åˆå§‹åŒ–æˆåŠŸ');
                } else {
                    updateEngineStatus('åˆå§‹åŒ–å¤±è´¥');
                    console.error('âŒ 3D å¼•æ“åˆå§‹åŒ–å¤±è´¥');
                }
            } catch (error) {
                updateEngineStatus('åˆå§‹åŒ–é”™è¯¯');
                console.error('âŒ 3D å¼•æ“åˆå§‹åŒ–é”™è¯¯:', error);
            }
        }

        /**
         * åŠ è½½ 3D æ¨¡å‹
         */
        function loadModel() {
            if (!engine || !engine.engine) {
                alert('å¼•æ“æœªåˆ›å»ºï¼Œè¯·å…ˆç­‰å¾…é¡µé¢åŠ è½½å®Œæˆ');
                return;
            }

            if (!engine.engine.isInitialized()) {
                alert('è¯·å…ˆåˆå§‹åŒ– 3D å¼•æ“ï¼');
                return;
            }

            try {
                // åŠ è½½æ¨¡å‹æ–‡ä»¶ï¼ˆä» model ç›®å½•ï¼‰
                const modelUrl = './model/gujianzhu.glb';

                engine.engine.loadModel(modelUrl, {
                    position: [0, 0, 0],    // åˆå§‹ä½ç½®
                    rotation: [0, 0, 0],       // åˆå§‹æ—‹è½¬
                    scale: [1, 1, 1]         // åˆå§‹ç¼©æ”¾
                });

                console.log('âœ… æ¨¡å‹åŠ è½½è¯·æ±‚å·²å‘é€:', modelUrl);
            } catch (error) {
                console.error('âŒ æ¨¡å‹åŠ è½½é”™è¯¯:', error);
            }
        }

        /**
         * æ›´æ–°å¼•æ“çŠ¶æ€æ˜¾ç¤º
         */
        function updateEngineStatus(status) {
            const statusEl = document.getElementById('engine-status');
            if (statusEl) {
                statusEl.textContent = status;
                // æ ¹æ®çŠ¶æ€è®¾ç½®é¢œè‰²
                if (status === 'å·²åˆå§‹åŒ–') {
                    statusEl.style.color = '#28a745';
                } else if (status === 'åˆå§‹åŒ–å¤±è´¥' || status === 'åˆå§‹åŒ–é”™è¯¯') {
                    statusEl.style.color = '#dc3545';
                } else {
                    statusEl.style.color = '#666';
                }
            }
        }
    </script>
</body>

</html>
