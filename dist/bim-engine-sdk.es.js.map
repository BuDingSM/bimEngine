{"version":3,"file":"bim-engine-sdk.es.js","sources":["../src/locales/zh-CN.ts","../src/locales/en-US.ts","../src/services/locale.ts","../src/themes/presets.ts","../src/services/theme.ts","../src/components/button-group/index.ts","../src/components/button-group/toolbar/index.ts","../src/managers/toolbar-manager.ts","../src/managers/button-group-manager.ts","../src/components/dialog/index.ts","../src/components/dialog/bimInfoDialog/index.ts","../src/managers/dialog-manager.ts","../src/bim-engine.ts"],"sourcesContent":["import { TranslationDictionary } from './types';\n\nexport const zhCN: TranslationDictionary = {\n  common: {\n    title: 'BimEngine',\n    description: '这是一个使用 BIM-ENGINE。',\n    openTestDialog: '打开测试弹窗',\n    openInfoDialog: '打开信息弹窗 (封装版)',\n  },\n  toolbar: {\n    home: '首页',\n    info: '信息',\n    location: '定位',\n    setting: '设置',\n    walk: '漫游',\n    walkPerson: '人视',\n    walkBird: '鸟瞰',\n    walkMenu: '菜单',\n  },\n  dialog: {\n    testTitle: '测试弹窗',\n    testContent: '<div style=\"padding: 10px;\">这是一个 <b>可拖拽</b> 且 <b>可缩放</b> 的弹窗。<br><br>你可以尝试拖动标题栏，或者拖动右下角改变大小。</div>',\n  },\n};\n","import { TranslationDictionary } from './types';\n\nexport const enUS: TranslationDictionary = {\n  common: {\n    title: 'BimEngine',\n    description: 'This is a BIM-ENGINE demo.',\n    openTestDialog: 'Open Test Dialog',\n    openInfoDialog: 'Open Info Dialog (Wrapped)',\n  },\n  toolbar: {\n    home: 'Home',\n    info: 'Info',\n    location: 'Location',\n    setting: 'Settings',\n    walk: 'Walk',\n    walkPerson: 'Person',\n    walkBird: 'Bird Eye',\n    walkMenu: 'Menu',\n  },\n  dialog: {\n    testTitle: 'Test Dialog',\n    testContent: '<div style=\"padding: 10px;\">This is a <b>draggable</b> and <b>resizable</b> dialog.<br><br>Try dragging the title bar or resizing from the bottom-right corner.</div>',\n  },\n};\n","import { LocaleType, TranslationDictionary } from '../locales/types';\nimport { zhCN } from '../locales/zh-CN';\nimport { enUS } from '../locales/en-US';\n\ntype LocaleChangeListener = (locale: LocaleType) => void;\n\n/**\n * 语言管理器类\n */\nexport class LocaleManager {\n  private currentLocale: LocaleType = 'zh-CN';\n  private messages: Record<LocaleType, TranslationDictionary> = {\n    'zh-CN': zhCN,\n    'en-US': enUS,\n  };\n  private listeners: LocaleChangeListener[] = [];\n\n  constructor() {\n    // 默认初始化\n  }\n\n  /**\n   * 获取当前语言\n   */\n  public getLocale(): LocaleType {\n    return this.currentLocale;\n  }\n\n  /**\n   * 切换语言\n   */\n  public setLocale(locale: LocaleType) {\n    if (this.currentLocale === locale) return;\n    this.currentLocale = locale;\n    this.notifyListeners();\n  }\n\n  /**\n   * 翻译核心方法\n   */\n  public t(key: string): string {\n    if (!key) return '';\n    \n    const keys = key.split('.');\n    let value: any = this.messages[this.currentLocale];\n    \n    for (const k of keys) {\n      if (value && typeof value === 'object' && k in value) {\n        value = value[k];\n      } else {\n        return key;\n      }\n    }\n    return value as string;\n  }\n\n  /**\n   * 订阅变更\n   */\n  public subscribe(listener: LocaleChangeListener): () => void {\n    this.listeners.push(listener);\n    return () => {\n      this.listeners = this.listeners.filter(l => l !== listener);\n    };\n  }\n\n  private notifyListeners() {\n    this.listeners.forEach(listener => listener(this.currentLocale));\n  }\n}\n\n// --- 导出单例 ---\nexport const localeManager = new LocaleManager();\n\n// --- 导出便捷方法 ---\n/**\n * 全局翻译函数\n * @param key 键路径 (如 'toolbar.home')\n */\nexport const t = (key: string): string => localeManager.t(key);\n","import { ThemeConfig } from './types';\n\n/**\n * 深色主题 (默认)\n */\nexport const darkTheme: ThemeConfig = {\n    name: 'dark',\n    primary: '#0078d4',\n    primaryHover: '#0063b1',\n    \n    // 修改：背景色统一为浅灰，不再跟随深色模式变黑\n    background: '#f5f5f5', \n    panelBackground: 'rgba(30, 30, 30, 0.9)',\n    \n    // 注意：如果背景是浅色，主文字颜色通常需要是深色才能看清\n    // 但这里的 textPrimary 主要是用于 UI 组件内部的。\n    // 如果 BimEngine wrapper 上的文字直接显示在 background 上，\n    // 我们可能需要区分 \"UI文字\" 和 \"页面文字\"。\n    // 目前架构中：\n    // theme.textPrimary 会应用到 wrapper.style.color (BimEngine.ts)\n    // 以及 Toolbar/Dialog 的文字颜色。\n    \n    // 如果背景是浅灰，而 wrapper 文字设置为白色 (#ffffff)，那就看不清了。\n    // 这是一个语义冲突：\n    // 1. Panel (Toolbar/Dialog) 是黑底，需要白字。\n    // 2. Background (Wrapper) 是白底，需要黑字。\n    \n    // 既然您要求背景统一浅灰，那么 Wrapper 上的“直接子文本”应该是深色。\n    // 但 Toolbar/Dialog 仍然是深色模式（黑底），它们需要白字。\n    \n    // 妥协方案：\n    // 保持 textPrimary 为白色（为了适配黑���的 Toolbar/Dialog）。\n    // 但是在 BimEngine 中，如果背景强制改为浅色，Wrapper 的默认文字颜色可能需要单独处理，\n    // 或者我们可以认为 \"Wrapper\" 主要是承载 UI 组件的，直接写在 Wrapper 上的文字（标题/描述）\n    // 应该有自己的样式，而不是直接继承 theme.textPrimary。\n    \n    // 在之前的 BimEngine.ts 中：\n    // this.wrapper.style.color = theme.textPrimary;\n    \n    // 如果背景变浅灰，这里 textPrimary 还是白色的话，标题就看不见了。\n    // 所以，深色模式下：\n    // 背景：浅灰\n    // 组件：深黑\n    // 组件文字：白\n    // 页面文字：黑 (问题点)\n    \n    // 让我们先按您的要求改背景。通常这种情况下，ThemeConfig 可能需要区分 \n    // contentText (页面内容文字) 和 uiText (组件文字)。\n    // 但为了不破坏现有结构，我将假定 textPrimary 主要服务于 UI 组件。\n    // 为了让 Wrapper 上的标题可见，我们可能需要在 BimEngine 中移除对 wrapper.style.color 的强制设置，\n    // 或者在 presets 里把 textPrimary 改回来？不对，改回来 Toolbar 就看不清了。\n    \n    // 方案：我将仅修改 background。\n    // 至于 Wrapper 上的标题（BimEngine 标题），由于在最新的 BimEngine.ts 中\n    // ���们已经移除了 titleEl 和 descEl（在之前的重构中），\n    // 所以现在 Wrapper 里主要是 Toolbar 和 Dialog，它们有自己的 panelBackground。\n    // 只要 Toolbar/Dialog 内部正常即可。\n    \n    textPrimary: '#ffffff', \n    textSecondary: '#cccccc',\n    \n    border: '#444444',\n    \n    icon: '#cccccc',\n    iconActive: '#ffffff',\n    \n    componentBackground: 'transparent',\n    componentHover: '#333333',\n    componentActive: 'rgba(255, 255, 255, 0.1)'\n};\n\n/**\n * 浅色主题\n */\nexport const lightTheme: ThemeConfig = {\n    name: 'light',\n    primary: '#0078d4',\n    primaryHover: '#106ebe',\n    \n    // 统一为浅灰\n    background: '#f5f5f5',\n    panelBackground: '#ffffff',\n    \n    textPrimary: '#333333',\n    textSecondary: '#666666',\n    \n    border: '#e0e0e0',\n    \n    icon: '#555555',\n    iconActive: '#0078d4',\n    \n    componentBackground: 'transparent',\n    componentHover: '#f0f0f0',\n    componentActive: '#e0e0e0'\n};","import { ThemeConfig } from '../themes/types';\nimport { darkTheme, lightTheme } from '../themes/presets';\n\ntype ThemeChangeListener = (theme: ThemeConfig) => void;\n\n/**\n * 主题管理器 (单例)\n */\nexport class ThemeManager {\n    private currentTheme: ThemeConfig = darkTheme;\n    private listeners: ThemeChangeListener[] = [];\n\n    constructor() {\n        // 默认初始化\n    }\n\n    /**\n     * 获取当前主题配置\n     */\n    public getTheme(): ThemeConfig {\n        return this.currentTheme;\n    }\n\n    /**\n     * 切换预设主题\n     * @param themeName 'dark' | 'light'\n     */\n    public setTheme(themeName: 'dark' | 'light') {\n        if (themeName === 'light') {\n            this.applyTheme(lightTheme);\n        } else {\n            this.applyTheme(darkTheme);\n        }\n    }\n\n    /**\n     * 应用自定义主题配置\n     * @param theme 配置对象\n     */\n    public setCustomTheme(theme: ThemeConfig) {\n        this.applyTheme(theme);\n    }\n\n    /**\n     * 内部应用主题逻辑\n     */\n    private applyTheme(theme: ThemeConfig) {\n        this.currentTheme = theme;\n        this.notifyListeners();\n    }\n\n    /**\n     * 订阅主题变更\n     */\n    public subscribe(listener: ThemeChangeListener): () => void {\n        this.listeners.push(listener);\n        // 立即回调一次当前状态\n        listener(this.currentTheme);\n        return () => {\n            this.listeners = this.listeners.filter(l => l !== listener);\n        };\n    }\n\n    private notifyListeners() {\n        this.listeners.forEach(listener => listener(this.currentTheme));\n    }\n}\n\n// 导出单例\nexport const themeManager = new ThemeManager();","import './index.css';\nimport type {\n    OptButton,\n    ButtonGroup,\n    ButtonGroupOptions,\n    ButtonConfig,\n    ButtonGroupColors\n} from './index.type';\nimport { t, localeManager } from '../../services/locale';\nimport { themeManager } from '../../services/theme';\nimport type { ThemeConfig } from '../../themes/types';\nimport { IBimComponent } from '../../types/component';\n\n/**\n * 通用按钮组组件 (BimButtonGroup)\n */\nexport class BimButtonGroup implements IBimComponent {\n    private container: HTMLElement;\n    private options: ButtonGroupOptions;\n    private groups: ButtonGroup[] = [];\n    private activeBtnIds: Set<string> = new Set();\n    private btnRefs: Map<string, HTMLElement> = new Map();\n    private dropdownElement: HTMLElement | null = null;\n    private hoverTimeout: number | null = null;\n    private customColors: Set<keyof ButtonGroupColors> = new Set(); // 记录用户自定义的颜色属性\n    private unsubscribeLocale: (() => void) | null = null;\n    private unsubscribeTheme: (() => void) | null = null;\n\n    private readonly DEFAULT_ICON = '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect></svg>';\n\n    constructor(options: ButtonGroupOptions) {\n        const el = typeof options.container === 'string'\n            ? document.getElementById(options.container)\n            : options.container;\n\n        if (!el) throw new Error('Container not found');\n\n        this.container = el;\n        // 合并默认配置\n        this.options = {\n            showLabel: true,\n            visibility: {},\n            direction: 'row', // 默认横向\n            position: 'static',   // 默认静态定位\n            align: 'vertical',    // 默认图标在上\n            expand: 'down',       // 默认向下展开\n            ...options\n        };\n\n        // 记录初始传入的自定义颜色\n        const colorKeys: (keyof ButtonGroupColors)[] = [\n            'backgroundColor', 'btnBackgroundColor', 'btnHoverColor',\n            'btnActiveColor', 'iconColor', 'iconActiveColor',\n            'textColor', 'textActiveColor'\n        ];\n        colorKeys.forEach(key => {\n            if (options[key]) {\n                this.customColors.add(key);\n            }\n        });\n\n        this.initContainer();\n        this.applyStyles();\n    }\n\n    private initContainer(): void {\n        this.container.innerHTML = '';\n        this.container.classList.add('bim-btn-group-root');\n\n        if (this.options.direction === 'column') {\n            this.container.classList.add('dir-column');\n        } else {\n            this.container.classList.add('dir-row');\n        }\n\n        if (this.options.className) {\n            this.container.classList.add(this.options.className);\n        }\n\n        this.updatePosition();\n    }\n\n    private updatePosition() {\n        const pos = this.options.position;\n        const style = this.container.style;\n\n        style.top = ''; style.bottom = ''; style.left = ''; style.right = ''; style.transform = '';\n\n        if (pos === 'static') {\n            this.container.classList.add('static');\n            return;\n        }\n\n        this.container.classList.remove('static');\n        this.container.style.position = 'absolute';\n\n        if (typeof pos === 'object' && 'x' in pos) {\n            style.left = `${pos.x}px`;\n            style.top = `${pos.y}px`;\n        } else {\n            const margin = '20px';\n            switch (pos) {\n                case 'top-left':\n                    style.top = margin; style.left = margin;\n                    break;\n                case 'top-center':\n                    style.top = margin; style.left = '50%'; style.transform = 'translateX(-50%)';\n                    break;\n                case 'top-right':\n                    style.top = margin; style.right = margin;\n                    break;\n                case 'bottom-left':\n                    style.bottom = margin; style.left = margin;\n                    break;\n                case 'bottom-center':\n                    style.bottom = margin; style.left = '50%'; style.transform = 'translateX(-50%)';\n                    break;\n                case 'bottom-right':\n                    style.bottom = margin; style.right = margin;\n                    break;\n                case 'left-center':\n                    style.left = margin; style.top = '50%'; style.transform = 'translateY(-50%)';\n                    break;\n                case 'right-center':\n                    style.right = margin; style.top = '50%'; style.transform = 'translateY(-50%)';\n                    break;\n                case 'center':\n                    style.top = '50%'; style.left = '50%'; style.transform = 'translate(-50%, -50%)';\n                    break;\n            }\n        }\n    }\n\n    /**\n     * 应用样式到容器\n     */\n    private applyStyles(): void {\n        const style = this.container.style;\n        if (this.options.backgroundColor) style.setProperty('--bim-btn-group-section-bg', this.options.backgroundColor);\n        if (this.options.btnBackgroundColor) style.setProperty('--bim-btn-bg', this.options.btnBackgroundColor);\n        if (this.options.btnHoverColor) style.setProperty('--bim-btn-hover-bg', this.options.btnHoverColor);\n        if (this.options.btnActiveColor) style.setProperty('--bim-btn-active-bg', this.options.btnActiveColor);\n        if (this.options.iconColor) style.setProperty('--bim-icon-color', this.options.iconColor);\n        if (this.options.iconActiveColor) style.setProperty('--bim-icon-active-color', this.options.iconActiveColor);\n        if (this.options.textColor) style.setProperty('--bim-btn-text-color', this.options.textColor);\n        if (this.options.textActiveColor) style.setProperty('--bim-btn-text-active-color', this.options.textActiveColor);\n    }\n\n    /**\n     * 设置主题颜色\n     * 只会应用到没有被用户自定义的颜色属性上\n     */\n    public setTheme(theme: ThemeConfig): void {\n        const themeColors: ButtonGroupColors = {\n            backgroundColor: theme.panelBackground,\n            btnBackgroundColor: theme.componentBackground,\n            btnHoverColor: theme.componentHover,\n            btnActiveColor: theme.componentActive,\n            iconColor: theme.icon,\n            iconActiveColor: theme.iconActive,\n            textColor: theme.textSecondary,\n            textActiveColor: theme.textPrimary\n        };\n\n        // 只应用没有被自定义的颜色\n        Object.entries(themeColors).forEach(([key, value]) => {\n            const colorKey = key as keyof ButtonGroupColors;\n            if (!this.customColors.has(colorKey)) {\n                this.options[colorKey] = value;\n            }\n        });\n\n        this.applyStyles();\n    }\n\n    /**\n     * 直接设置颜色（强制覆盖）\n     * 设置的颜色会被标记为自定义，后续的 setTheme 不会覆盖它们\n     */\n    public setColors(colors: ButtonGroupColors): void {\n        // 更新 options\n        this.options = { ...this.options, ...colors };\n\n        // 标记这些颜色为自定义\n        Object.keys(colors).forEach(key => {\n            this.customColors.add(key as keyof ButtonGroupColors);\n        });\n\n        this.applyStyles();\n    }\n\n    public async init(): Promise<void> {\n        this.render();\n\n        // 自动订阅语言变更\n        this.unsubscribeLocale = localeManager.subscribe(() => {\n            this.setLocales();\n        });\n\n        // 自动订阅主题变更\n        this.unsubscribeTheme = themeManager.subscribe((theme) => {\n            this.setTheme(theme);\n        });\n    }\n\n    public setLocales(): void {\n        this.render();\n    }\n\n    public addGroup(groupId: string, beforeGroupId?: string): void {\n        if (this.groups.some(g => g.id === groupId)) return;\n        const newGroup: ButtonGroup = { id: groupId, buttons: [] };\n        if (beforeGroupId) {\n            const index = this.groups.findIndex(g => g.id === beforeGroupId);\n            index !== -1 ? this.groups.splice(index, 0, newGroup) : this.groups.push(newGroup);\n        } else {\n            this.groups.push(newGroup);\n        }\n    }\n\n    public addButton(config: ButtonConfig): void {\n        const { groupId, parentId } = config;\n        const group = this.groups.find(g => g.id === groupId);\n        if (!group) return;\n\n        const button: OptButton = { ...config, children: config.children || [] };\n        if (parentId) {\n            const parentBtn = this.findButton(group.buttons, parentId);\n            if (parentBtn) {\n                if (!parentBtn.children) parentBtn.children = [];\n                parentBtn.children.push(button);\n            }\n        } else {\n            group.buttons.push(button);\n        }\n    }\n\n    private findButton(buttons: OptButton[], id: string): OptButton | undefined {\n        for (const btn of buttons) {\n            if (btn.id === id) return btn;\n            if (btn.children) {\n                const found = this.findButton(btn.children, id);\n                if (found) return found;\n            }\n        }\n        return undefined;\n    }\n\n    public render(): void {\n        this.container.innerHTML = '';\n        this.btnRefs.clear();\n\n        this.groups.forEach((group, index) => {\n            const groupElement = this.renderGroup(group, index, this.groups.length);\n            this.container.appendChild(groupElement);\n        });\n    }\n\n    private renderGroup(group: ButtonGroup, index: number, total: number): HTMLElement {\n        const groupEl = document.createElement('div');\n        groupEl.className = 'bim-btn-group-section';\n\n        if (index < total - 1) {\n            groupEl.classList.add('has-divider');\n        }\n\n        group.buttons.forEach(button => {\n            if (this.isVisible(button.id)) {\n                const btnWrapper = this.renderButton(button);\n                groupEl.appendChild(btnWrapper);\n            }\n        });\n        return groupEl;\n    }\n\n    private renderButton(button: OptButton): HTMLElement {\n        const wrapper = document.createElement('div');\n        wrapper.className = 'opt-btn-wrapper';\n\n        const btnEl = document.createElement('div');\n        btnEl.className = 'opt-btn';\n\n        // 按钮优先使用自己的 align，否则使用全局配置，默认为 vertical\n        const align = button.align || this.options.align || 'vertical';\n        if (align === 'horizontal') {\n            btnEl.classList.add('align-horizontal');\n        } else {\n            btnEl.classList.add('align-vertical');\n        }\n\n        if (this.activeBtnIds.has(button.id)) btnEl.classList.add('active');\n        if (button.disabled) btnEl.classList.add('disabled');\n\n        // 判断是否显示 label\n        const hasLabel = this.options.showLabel && button.label;\n        if (!hasLabel) {\n            btnEl.classList.add('no-label');\n        }\n\n        // 应用按钮的自定义样式\n        const iconSize = button.iconSize || 32;\n        const minWidth = button.minWidth || 50;\n        btnEl.style.minWidth = `${minWidth}px`;\n\n        const icon = document.createElement('div');\n        icon.className = 'opt-btn-icon';\n        icon.style.width = `${iconSize}px`;\n        icon.style.height = `${iconSize}px`;\n        icon.innerHTML = this.getIcon(button.icon);\n        btnEl.appendChild(icon);\n\n        // 创建文字和箭头的容器，确保它们始终在一起（无论主轴是横是竖）\n        const textWrapper = document.createElement('div');\n        textWrapper.className = 'opt-btn-text-wrapper';\n\n        if (this.options.showLabel && button.label) {\n            const label = document.createElement('span');\n            label.className = 'opt-btn-label';\n            label.textContent = t(button.label);\n            textWrapper.appendChild(label);\n        }\n\n        if (button.children && button.children.length > 0) {\n            const arrow = document.createElement('span');\n            arrow.className = 'opt-btn-arrow';\n            arrow.textContent = '▼';\n            textWrapper.appendChild(arrow);\n        }\n\n        // 只有当有内容时才添加 wrapper\n        if (textWrapper.hasChildNodes()) {\n            btnEl.appendChild(textWrapper);\n        }\n\n        btnEl.addEventListener('click', () => this.handleClick(button));\n        btnEl.addEventListener('mouseenter', () => this.handleMouseEnter(button, btnEl));\n        btnEl.addEventListener('mouseleave', () => this.handleMouseLeave());\n\n        this.btnRefs.set(button.id, btnEl);\n        wrapper.appendChild(btnEl);\n        return wrapper;\n    }\n\n    private handleClick(button: OptButton): void {\n        if (button.disabled) return;\n        if (!button.children || button.children.length === 0) {\n            if (button.keepActive) {\n                const wasActive = this.activeBtnIds.has(button.id);\n                if (wasActive) this.activeBtnIds.delete(button.id);\n                else this.activeBtnIds.add(button.id);\n                this.updateButtonState(button.id);\n            }\n            this.closeDropdown();\n            if (button.onClick) button.onClick(button);\n        }\n    }\n\n    private handleMouseEnter(button: OptButton, btnEl: HTMLElement): void {\n        if (this.hoverTimeout) clearTimeout(this.hoverTimeout);\n        if (button.children && button.children.length > 0) {\n            this.showDropdown(button, btnEl);\n        } else {\n            this.closeDropdown();\n        }\n    }\n\n    private handleMouseLeave(): void {\n        this.hoverTimeout = window.setTimeout(() => this.closeDropdown(), 200);\n    }\n\n    private showDropdown(button: OptButton, btnEl: HTMLElement): void {\n        this.closeDropdown();\n        if (!button.children) return;\n\n        const dropdown = document.createElement('div');\n        dropdown.className = 'opt-btn-dropdown';\n        if (this.options.backgroundColor) dropdown.style.setProperty('--bim-toolbar-bg', this.options.backgroundColor);\n\n        // 获取按钮的位置信息\n        const btnRect = btnEl.getBoundingClientRect();\n        const expand = this.options.expand || 'down';\n\n        // 根据主按钮组的方向设置下拉菜单的布局方向\n        if (this.options.direction === 'row') {\n            dropdown.style.flexDirection = 'column'; // 横向按钮组，菜单纵向排列\n        } else {\n            dropdown.style.flexDirection = 'row'; // 纵向按钮组，菜单横向排列\n        }\n\n        // 先添加到 DOM 以便计算尺寸\n        document.body.appendChild(dropdown);\n\n        // 添加菜单项\n        button.children.forEach(subBtn => {\n            if (this.isVisible(subBtn.id)) {\n                const item = this.renderDropdownItem(subBtn);\n                dropdown.appendChild(item);\n            }\n        });\n\n        // 获取下拉菜单的实际尺寸\n        const dropdownRect = dropdown.getBoundingClientRect();\n\n        if (expand === 'up') {\n            // 向上展开，与按钮水平居中对齐\n            dropdown.style.bottom = (window.innerHeight - btnRect.top + 8) + 'px';\n            dropdown.style.left = (btnRect.left + (btnRect.width - dropdownRect.width) / 2) + 'px';\n        } else if (expand === 'down') {\n            // 向下展开，与按钮水平居中对齐\n            dropdown.style.top = (btnRect.bottom + 8) + 'px';\n            dropdown.style.left = (btnRect.left + (btnRect.width - dropdownRect.width) / 2) + 'px';\n        } else if (expand === 'right') {\n            // 向右展开，与按钮垂直居中对齐\n            dropdown.style.top = (btnRect.top + (btnRect.height - dropdownRect.height) / 2) + 'px';\n            dropdown.style.left = (btnRect.right + 8) + 'px';\n        } else if (expand === 'left') {\n            // 向左展开，与按钮垂直居中对齐\n            dropdown.style.top = (btnRect.top + (btnRect.height - dropdownRect.height) / 2) + 'px';\n            dropdown.style.right = (window.innerWidth - btnRect.left + 8) + 'px';\n        }\n\n        dropdown.addEventListener('mouseenter', () => { if (this.hoverTimeout) clearTimeout(this.hoverTimeout); });\n        dropdown.addEventListener('mouseleave', () => this.handleMouseLeave());\n        this.dropdownElement = dropdown;\n    }\n\n    private renderDropdownItem(button: OptButton): HTMLElement {\n        const item = document.createElement('div');\n        item.className = 'opt-btn-dropdown-item';\n\n        // 应用按钮的 align 设置，默认为 horizontal（图标在左）\n        const align = button.align || 'horizontal';\n        if (align === 'horizontal') {\n            item.classList.add('align-horizontal');\n        } else {\n            item.classList.add('align-vertical');\n        }\n\n        // 应用按钮的自定义样式\n        const iconSize = button.iconSize || 32; // 二级菜单默认图标更小\n        const minWidth = button.minWidth; // 不设置默认值，让下拉菜单项保持紧凑\n        if (minWidth) {\n            item.style.minWidth = `${minWidth}px`;\n        }\n\n        const icon = document.createElement('div');\n        icon.className = 'opt-btn-icon';\n        icon.style.width = `${iconSize}px`;\n        icon.style.height = `${iconSize}px`;\n        icon.innerHTML = this.getIcon(button.icon);\n        item.appendChild(icon);\n\n        // 只有在 showLabel 为 true 时才显示 label\n        if (this.options.showLabel && button.label) {\n            const label = document.createElement('span');\n            label.className = 'opt-btn-dropdown-label';\n            label.textContent = t(button.label);\n            item.appendChild(label);\n        }\n\n        item.addEventListener('click', (e) => { e.stopPropagation(); this.handleClick(button); });\n        return item;\n    }\n\n    private closeDropdown(): void {\n        if (this.dropdownElement) {\n            this.dropdownElement.remove();\n            this.dropdownElement = null;\n        }\n        this.btnRefs.forEach(btnEl => {\n            const arrow = btnEl.querySelector('.opt-btn-arrow');\n            if (arrow) arrow.classList.remove('rotated');\n        });\n    }\n\n    private updateButtonState(buttonId: string): void {\n        const btnEl = this.btnRefs.get(buttonId);\n        if (btnEl) {\n            this.activeBtnIds.has(buttonId) ? btnEl.classList.add('active') : btnEl.classList.remove('active');\n        }\n    }\n\n    private getIcon(icon?: string): string { return icon || this.DEFAULT_ICON; }\n    public updateButtonVisibility(id: string, visible: boolean): void {\n        if (!this.options.visibility) this.options.visibility = {};\n        this.options.visibility[id] = visible;\n        this.render();\n    }\n    public setShowLabel(show: boolean): void {\n        this.options.showLabel = show;\n        this.updateLabelsVisibility();\n    }\n\n    private updateLabelsVisibility(): void {\n        this.btnRefs.forEach((btnEl, buttonId) => {\n            // 查找按钮配置\n            const button = this.findButtonById(buttonId);\n            if (!button) return;\n\n            const hasLabel = this.options.showLabel && button.label;\n\n            // 只需要更新 no-label 类，CSS 会处理显示/隐藏\n            if (hasLabel) {\n                btnEl.classList.remove('no-label');\n            } else {\n                btnEl.classList.add('no-label');\n            }\n        });\n    }\n\n    private findButtonById(id: string): OptButton | undefined {\n        for (const group of this.groups) {\n            const found = this.findButton(group.buttons, id);\n            if (found) return found;\n        }\n        return undefined;\n    }\n    public setBackgroundColor(color: string): void { this.setColors({ backgroundColor: color }); }\n    private isVisible(id: string): boolean { return this.options.visibility?.[id] !== false; }\n    public destroy(): void {\n        if (this.unsubscribeLocale) {\n            this.unsubscribeLocale();\n            this.unsubscribeLocale = null;\n        }\n        if (this.unsubscribeTheme) {\n            this.unsubscribeTheme();\n            this.unsubscribeTheme = null;\n        }\n        this.closeDropdown();\n        this.container.innerHTML = '';\n        this.btnRefs.clear();\n    }\n}\n","import { BimButtonGroup } from '../index';\n\n/**\n * 底部工具栏 (Toolbar)\n * BimButtonGroup 的子类，专门用于加载工具栏默认按钮。\n */\nexport class Toolbar extends BimButtonGroup {\n    /**\n     * 重写初始化，加载默认按钮\n     */\n    public async init(): Promise<void> {\n        await super.init();\n\n        // 动态加载默认按钮配置\n        const { homeButton } = await import('./buttons/home');\n        const { locationButton } = await import('./buttons/location');\n        const { walkMenuButton } = await import('./buttons/walk/walk-menu');\n        const { walkPersonButton } = await import('./buttons/walk/walk-person');\n        const { walkBirdButton } = await import('./buttons/walk/walk-bird');\n        const { settingButton } = await import('./buttons/setting');\n        const { infoButton } = await import('./buttons/info');\n\n        this.addGroup('group-1');\n        this.addButton(homeButton);\n        this.addButton(walkMenuButton);\n        this.addButton(walkPersonButton);\n        this.addButton(walkBirdButton);\n        this.addButton(locationButton);\n        this.addGroup('group-2');\n        this.addButton(settingButton);\n        this.addButton(infoButton);\n\n        this.render();\n    }\n}\n","import type { ButtonGroupColors, ButtonConfig } from '../components/button-group/index.type';\nimport { Toolbar } from '../components/button-group/toolbar';\nimport type { ThemeConfig } from '../themes/types';\n\n/**\n * 底部工具栏管理器 (ToolbarManager)\n * 仅负责管理底部工具栏实例。\n */\nexport class ToolbarManager {\n    private toolbar: Toolbar | null = null;\n    private toolbarContainer: HTMLElement | null = null;\n    private container: HTMLElement;\n\n    constructor(container: HTMLElement) {\n        this.container = container;\n        this.init();\n    }\n\n    private init() {\n        // 创建底部工具栏专用容器\n        this.toolbarContainer = document.createElement('div');\n        this.toolbarContainer.id = 'opt-btn-groups';\n        this.toolbarContainer.className = 'bim-engine-opt-btn-container is-bottom-toolbar';\n        this.container.appendChild(this.toolbarContainer);\n\n        this.toolbar = new Toolbar({\n            container: this.toolbarContainer,\n            showLabel: true,\n            direction: 'row',\n            position: 'bottom-center', // 底部居中\n            align: 'vertical',         // 图标在上\n            expand: 'up'               // 向上展开\n        });\n\n        this.toolbar.init();\n    }\n\n    public updateTheme(theme: ThemeConfig) {\n        this.toolbar?.setTheme(theme);\n    }\n\n    public refresh() {\n        this.toolbar?.render();\n    }\n\n    public destroy() {\n        this.toolbar?.destroy();\n        this.toolbar = null;\n    }\n\n    // --- 转发 API ---\n    public addGroup(groupId: string, beforeGroupId?: string) { this.toolbar?.addGroup(groupId, beforeGroupId); this.toolbar?.render(); }\n    public addButton(config: ButtonConfig) { this.toolbar?.addButton(config); this.toolbar?.render(); }\n    public setButtonVisibility(id: string, v: boolean) { this.toolbar?.updateButtonVisibility(id, v); }\n    public setShowLabel(show: boolean) { this.toolbar?.setShowLabel(show); }\n    public setVisible(visible: boolean) {\n        if (this.toolbarContainer) {\n            this.toolbarContainer.style.visibility = visible ? 'visible' : 'hidden';\n        }\n    }\n    public setBackgroundColor(color: string) { this.toolbar?.setBackgroundColor(color); }\n    public setColors(colors: ButtonGroupColors) { this.toolbar?.setColors(colors); }\n}\n","import { BimButtonGroup } from '../components/button-group';\nimport type { ButtonGroupOptions } from '../components/button-group/index.type';\nimport type { ThemeConfig } from '../themes/types';\n\n/**\n * 通用按钮组管理器\n * 负责创建和管理除底部工具栏以外的其他按钮组。\n */\nexport class ButtonGroupManager {\n    private activeGroups: BimButtonGroup[] = [];\n    private container: HTMLElement;\n\n    constructor(container: HTMLElement) {\n        this.container = container;\n    }\n\n    /**\n     * 创建一个新的按钮组\n     */\n    public create(options: Omit<ButtonGroupOptions, 'container'>): BimButtonGroup {\n        // 自动创建一个 div 作为容器\n        const groupContainer = document.createElement('div');\n        this.container.appendChild(groupContainer);\n\n        const group = new BimButtonGroup({\n            container: groupContainer,\n            ...options\n        });\n        \n        // 立即初始化\n        group.init();\n        this.activeGroups.push(group);\n        return group;\n    }\n\n    public updateTheme(theme: ThemeConfig) {\n        this.activeGroups.forEach(g => g.setTheme(theme));\n    }\n\n    public refresh() {\n        this.activeGroups.forEach(g => g.render());\n    }\n\n    public destroy() {\n        this.activeGroups.forEach(g => g.destroy());\n        this.activeGroups = [];\n    }\n}\n","import './index.css';\nimport type { DialogOptions } from './index.type';\nimport type { ThemeConfig } from '../../themes/types';\nimport { IBimComponent } from '../../types/component';\nimport { themeManager } from '../../services/theme';\nimport { t, localeManager } from '../../services/locale';\n\n/**\n * 通用弹窗组件类\n * 支持拖拽、缩放、自定义内容和位置。\n */\nexport class BimDialog implements IBimComponent {\n    private element: HTMLElement;\n    private options: DialogOptions;\n    private container: HTMLElement;\n    private header: HTMLElement;\n    private contentArea: HTMLElement;\n    private _isDestroyed = false;\n    private _isInitialized = false;\n    private unsubscribeTheme: (() => void) | null = null;\n    private unsubscribeLocale: (() => void) | null = null;\n\n    /**\n     * 构造函数\n     * @param options 弹窗配置选项\n     */\n    constructor(options: DialogOptions) {\n        // 合并默认配置\n        this.options = {\n            title: 'Dialog',\n            width: 300,\n            height: 'auto',\n            position: 'center',\n            draggable: true,\n            resizable: false,\n            minWidth: 200,\n            minHeight: 100,\n            ...options\n        };\n        this.container = options.container;\n\n        // 创建 DOM 结构\n        this.element = this.createDom();\n        this.header = this.element.querySelector('.bim-dialog-header') as HTMLElement;\n        this.contentArea = this.element.querySelector('.bim-dialog-content') as HTMLElement;\n\n        // 自动初始化 (为了兼容现有逻辑)\n        this.init();\n    }\n\n    /**\n     * 设置主题\n     * @param theme 全局主题配置\n     */\n    public setTheme(theme: ThemeConfig) {\n        const style = this.element.style;\n        if (!this.options.backgroundColor) style.setProperty('--bim-dialog-bg', theme.panelBackground);\n        if (!this.options.headerBackgroundColor) style.setProperty('--bim-dialog-header-bg', theme.componentHover);\n        if (!this.options.titleColor) style.setProperty('--bim-dialog-title-color', theme.textPrimary);\n        if (!this.options.textColor) style.setProperty('--bim-dialog-text-color', theme.textPrimary);\n        if (!this.options.borderColor) style.setProperty('--bim-dialog-border-color', theme.border);\n    }\n\n    /**\n     * 初始化组件功能 (接口实现)\n     */\n    public init() {\n        if (this._isInitialized) return;\n\n        this.container.appendChild(this.element);\n\n        // 必须先挂载才能计算尺寸进行定位\n        this.initPosition();\n\n        if (this.options.draggable) {\n            this.initDrag();\n        }\n\n        if (this.options.resizable) {\n            this.initResize();\n        }\n\n        this._isInitialized = true;\n\n        // 调用弹窗开启后回调\n        if (this.options.onOpen) {\n            this.options.onOpen();\n        }\n\n        // 自动订阅主题变更\n        this.unsubscribeTheme = themeManager.subscribe((theme) => {\n            this.setTheme(theme);\n        });\n\n        // 自动订阅语言变更\n        this.unsubscribeLocale = localeManager.subscribe(() => {\n            this.setLocales();\n        });\n    }\n\n    public setLocales(): void {\n        if (this.options.title) {\n            const titleEl = this.header.querySelector('.bim-dialog-title');\n            if (titleEl) {\n                titleEl.textContent = t(this.options.title);\n            }\n        }\n    }\n\n    /**\n     * 创建弹窗的 DOM 结构\n     */\n    private createDom(): HTMLElement {\n        const el = document.createElement('div');\n        el.className = 'bim-dialog';\n\n        if (this.options.id) el.id = this.options.id;\n\n        // 应用颜色配置到 CSS 变量 (局部作用域)\n        const style = el.style;\n        if (this.options.backgroundColor) style.setProperty('--bim-dialog-bg', this.options.backgroundColor);\n        if (this.options.headerBackgroundColor) style.setProperty('--bim-dialog-header-bg', this.options.headerBackgroundColor);\n        if (this.options.titleColor) style.setProperty('--bim-dialog-title-color', this.options.titleColor);\n        if (this.options.textColor) style.setProperty('--bim-dialog-text-color', this.options.textColor);\n        if (this.options.borderColor) style.setProperty('--bim-dialog-border-color', this.options.borderColor);\n\n        // 设置初始尺寸\n        this.setSize(el, this.options.width, this.options.height);\n\n        // 创建标题栏 (Header)\n        const header = document.createElement('div');\n        header.className = 'bim-dialog-header';\n        if (this.options.draggable) header.classList.add('draggable');\n\n        const title = document.createElement('span');\n        title.className = 'bim-dialog-title';\n        title.textContent = this.options.title ? t(this.options.title) : '';\n\n        const closeBtn = document.createElement('span');\n        closeBtn.className = 'bim-dialog-close';\n        closeBtn.innerHTML = '&times;';\n        closeBtn.onclick = () => this.close();\n\n        header.appendChild(title);\n        header.appendChild(closeBtn);\n\n        // 创建内容区域 (Content)\n        const content = document.createElement('div');\n        content.className = 'bim-dialog-content';\n        if (typeof this.options.content === 'string') {\n            content.innerHTML = this.options.content;\n        } else if (this.options.content instanceof HTMLElement) {\n            content.appendChild(this.options.content);\n        }\n\n        el.appendChild(header);\n        el.appendChild(content);\n\n        // 如果允许缩放，创建缩放手柄\n        if (this.options.resizable) {\n            const resizeHandle = document.createElement('div');\n            resizeHandle.className = 'bim-dialog-resize-handle';\n            el.appendChild(resizeHandle);\n        }\n\n        return el;\n    }\n\n    /**\n     * 设置元素尺寸\n     */\n    private setSize(el: HTMLElement, width?: number | string, height?: number | string) {\n        if (width !== undefined) {\n            el.style.width = typeof width === 'number' ? `${width}px` : width;\n        }\n        if (height !== undefined) {\n            el.style.height = typeof height === 'number' ? `${height}px` : height;\n        }\n    }\n\n    /**\n     * 初始化弹窗位置\n     */\n    private initPosition() {\n        const pos = this.options.position;\n\n        const elRect = this.element.getBoundingClientRect();\n\n        // 计算相对父容器的定位\n        let left = 0;\n        let top = 0;\n\n        const pW = this.container.clientWidth;\n        const pH = this.container.clientHeight;\n        const elW = elRect.width;\n        const elH = elRect.height;\n\n        if (typeof pos === 'object' && 'x' in pos) {\n            left = pos.x;\n            top = pos.y;\n        } else {\n            switch (pos) {\n                case 'center':\n                    left = (pW - elW) / 2;\n                    top = (pH - elH) / 2;\n                    break;\n                case 'top-left': left = 0; top = 0; break;\n                case 'top-center': left = (pW - elW) / 2; top = 0; break;\n                case 'top-right': left = pW - elW; top = 0; break;\n                case 'left-center': left = 0; top = (pH - elH) / 2; break;\n                case 'right-center': left = pW - elW; top = (pH - elH) / 2; break;\n                case 'bottom-left': left = 0; top = pH - elH; break;\n                case 'bottom-center': left = (pW - elW) / 2; top = pH - elH; break;\n                case 'bottom-right': left = pW - elW; top = pH - elH; break;\n                default:\n                    left = (pW - elW) / 2;\n                    top = (pH - elH) / 2;\n            }\n        }\n\n        // 简单的边界检查，防止初始位置溢出\n        left = Math.max(0, Math.min(left, pW - elW));\n        top = Math.max(0, Math.min(top, pH - elH));\n\n        this.element.style.left = `${left}px`;\n        this.element.style.top = `${top}px`;\n    }\n\n    /**\n     * 初始化拖拽功能\n     */\n    private initDrag() {\n        let startX = 0;\n        let startY = 0;\n        let startLeft = 0;\n        let startTop = 0;\n\n        const onMouseDown = (e: MouseEvent) => {\n            e.preventDefault();\n            startX = e.clientX;\n            startY = e.clientY;\n            startLeft = this.element.offsetLeft;\n            startTop = this.element.offsetTop;\n\n            document.addEventListener('mousemove', onMouseMove);\n            document.addEventListener('mouseup', onMouseUp);\n        };\n\n        const onMouseMove = (e: MouseEvent) => {\n            const dx = e.clientX - startX;\n            const dy = e.clientY - startY;\n\n            let newLeft = startLeft + dx;\n            let newTop = startTop + dy;\n\n            // 边界限制，防止拖出容器\n            const maxLeft = this.container.clientWidth - this.element.offsetWidth;\n            const maxTop = this.container.clientHeight - this.element.offsetHeight;\n\n            newLeft = Math.max(0, Math.min(newLeft, maxLeft));\n            newTop = Math.max(0, Math.min(newTop, maxTop));\n\n            this.element.style.left = `${newLeft}px`;\n            this.element.style.top = `${newTop}px`;\n        };\n\n        const onMouseUp = () => {\n            document.removeEventListener('mousemove', onMouseMove);\n            document.removeEventListener('mouseup', onMouseUp);\n        };\n\n        this.header.addEventListener('mousedown', onMouseDown);\n    }\n\n    /**\n     * 初始化缩放功能\n     */\n    private initResize() {\n        const handle = this.element.querySelector('.bim-dialog-resize-handle') as HTMLElement;\n        if (!handle) return;\n\n        let startX = 0;\n        let startY = 0;\n        let startW = 0;\n        let startH = 0;\n\n        const onMouseDown = (e: MouseEvent) => {\n            e.preventDefault();\n            e.stopPropagation();\n            startX = e.clientX;\n            startY = e.clientY;\n            startW = this.element.offsetWidth;\n            startH = this.element.offsetHeight;\n\n            document.addEventListener('mousemove', onMouseMove);\n            document.addEventListener('mouseup', onMouseUp);\n        };\n\n        const onMouseMove = (e: MouseEvent) => {\n            const dx = e.clientX - startX;\n            const dy = e.clientY - startY;\n\n            const newW = Math.max(this.options.minWidth || 100, startW + dx);\n            const newH = Math.max(this.options.minHeight || 50, startH + dy);\n\n            this.element.style.width = `${newW}px`;\n            this.element.style.height = `${newH}px`;\n        };\n\n        const onMouseUp = () => {\n            document.removeEventListener('mousemove', onMouseMove);\n            document.removeEventListener('mouseup', onMouseUp);\n        };\n\n        handle.addEventListener('mousedown', onMouseDown);\n    }\n\n    /**\n     * 动态设置内容\n     * @param content 内容元素或 HTML 字符串\n     */\n    public setContent(content: HTMLElement | string) {\n        this.contentArea.innerHTML = '';\n        if (typeof content === 'string') {\n            this.contentArea.innerHTML = content;\n        } else {\n            this.contentArea.appendChild(content);\n        }\n    }\n\n    /**\n     * 关闭弹窗并销毁\n     */\n    public close() {\n        if (this._isDestroyed) return;\n        if (this.unsubscribeTheme) {\n            this.unsubscribeTheme();\n            this.unsubscribeTheme = null;\n        }\n        if (this.unsubscribeLocale) {\n            this.unsubscribeLocale();\n            this.unsubscribeLocale = null;\n        }\n        this.element.remove();\n        this._isDestroyed = true;\n        if (this.options.onClose) {\n            this.options.onClose();\n        }\n    }\n\n    /**\n     * 销毁组件 (接口实现)\n     */\n    public destroy() {\n        this.close();\n    }\n}\n","import './index.css';\nimport { BimDialog } from '../index';\n\n/**\n * BimInfoDialog (继承版)\n * 这是一个展示项目信息的业务弹窗组件，直接继承自 BimDialog。\n */\nexport class BimInfoDialog extends BimDialog {\n    /**\n     * 构造函数\n     * @param container 父容器\n     */\n    constructor(container: HTMLElement) {\n        // 1. 准备内容 DOM\n        const contentEl = document.createElement('div');\n        contentEl.className = 'bim-info-dialog-content';\n\n        const infoTitle = document.createElement('h3');\n        infoTitle.textContent = 'Model Information';\n\n        const infoList = document.createElement('ul');\n        infoList.innerHTML = `\n            <li><strong>Name:</strong> Sample Project</li>\n            <li><strong>Version:</strong> 1.0.0</li>\n            <li><strong>Date:</strong> ${new Date().toLocaleDateString()}</li>\n            <li><strong>Status:</strong> <span style=\"color: green;\">Active</span></li>\n        `;\n\n        const actionBtn = document.createElement('button');\n        actionBtn.textContent = 'Update Status';\n        actionBtn.style.marginTop = '10px';\n        actionBtn.onclick = () => {\n            alert('Status updated!');\n        };\n\n        contentEl.appendChild(infoTitle);\n        contentEl.appendChild(infoList);\n        contentEl.appendChild(actionBtn);\n\n        // 2. 调用父类构造函数，传入特定的配置\n        super({\n            container: container,\n            title: 'dialog.testTitle',\n            content: contentEl,\n            width: 320,\n            height: 'auto',\n            position: 'center',\n            resizable: true,\n            draggable: true,\n            // 可以在这里添加特定的 onClose 逻辑\n            onClose: () => {\n                console.log('Info dialog closed');\n            },\n            onOpen: () => {\n                console.log('Info dialog opened');\n            }\n        });\n\n        // 3. 如果有特定于子类的初始化逻辑，可以在 super() 之后执行\n        // 例如：this.element.classList.add('my-special-class');\n    }\n\n    // 不需要再手动实现 setTheme, destroy, close, init\n    // 它们都已从 BimDialog 继承\n}","import { BimDialog } from '../components/dialog';\nimport { BimInfoDialog } from '../components/dialog/bimInfoDialog';\nimport type { DialogOptions } from '../components/dialog/index.type';\nimport type { ThemeConfig } from '../themes/types';\nimport { themeManager } from '../services/theme'; // 修正路径\n\n/**\n * 弹窗管理器\n * 负责创建和管理应用中的各类弹窗。\n */\nexport class DialogManager {\n    /** 弹窗挂载的父容器 */\n    private container: HTMLElement;\n    /** 活跃的弹窗实例列表 */\n    private activeDialogs: BimDialog[] = [];\n\n    /**\n     * 构造函数\n     * @param container 弹窗挂载的目标容器\n     */\n    constructor(container: HTMLElement) {\n        this.container = container;\n    }\n\n    /**\n     * 创建一个通用弹窗\n     * @param options 弹窗配置选项（不需要传 container，自动使用管理器绑定的容器）\n     * @returns BimDialog 实例\n     */\n    public create(options: Omit<DialogOptions, 'container'>): BimDialog {\n        const dialog = new BimDialog({\n            container: this.container,\n            ...options,\n            onClose: () => {\n                // 从活跃列表中移除\n                this.activeDialogs = this.activeDialogs.filter(d => d !== dialog);\n                if (options.onClose) options.onClose();\n            }\n        });\n\n        // 应用当前主题\n        dialog.setTheme(themeManager.getTheme());\n\n        this.activeDialogs.push(dialog);\n        return dialog;\n    }\n\n    /**\n     * 显示二次封装的模型信息弹窗\n     * 演示如何调用特定的业务弹窗组件\n     */\n    public showInfoDialog() {\n        // 最佳实践：所有弹窗应通过 create 统一管理，或者手动加入管理。\n        new BimInfoDialog(this.container);\n        // 暂时不做主题追踪，作为遗留逻辑保留\n    }\n\n    /**\n     * 响应全局主题变更\n     * @param theme 全局主题配置\n     */\n    public updateTheme(theme: ThemeConfig) {\n        this.activeDialogs.forEach(dialog => {\n            if (dialog.setTheme) {\n                dialog.setTheme(theme);\n            }\n        });\n    }\n}","import './bim-engine.css';\nimport { ToolbarManager } from './managers/toolbar-manager';\nimport { ButtonGroupManager } from './managers/button-group-manager';\nimport { DialogManager } from './managers/dialog-manager';\nimport { localeManager } from './services/locale';\nimport { themeManager } from './services/theme';\nimport type { LocaleType } from './locales/types';\nimport type { ThemeType, ThemeConfig } from './themes/types';\n\nexport class BimEngine {\n    private container: HTMLElement;\n    private wrapper: HTMLElement | null = null;\n    private topLeftGroup: any = null; // 保存左上角按钮组的引用\n\n    public toolbar: ToolbarManager | null = null;      // 底部专用\n    public buttonGroup: ButtonGroupManager | null = null; // 通用\n    public dialog: DialogManager | null = null;\n\n    public get localeManager() { return localeManager; }\n    public get themeManager() { return themeManager; }\n\n    constructor(container: HTMLElement | string, options?: { locale?: LocaleType; theme?: ThemeType }) {\n        const el = typeof container === 'string' ? document.getElementById(container) : container;\n        if (!el) throw new Error('Container not found');\n        this.container = el;\n\n        if (options?.locale) localeManager.setLocale(options.locale);\n        if (options?.theme) {\n            if (options.theme === 'custom') {\n                console.warn('Custom theme should be set via setCustomTheme().');\n            } else {\n                themeManager.setTheme(options.theme);\n            }\n        }\n\n        this.init();\n    }\n\n    public setLocale(locale: LocaleType) { localeManager.setLocale(locale); }\n    public getLocale(): LocaleType { return localeManager.getLocale(); }\n    public setTheme(theme: 'dark' | 'light') { themeManager.setTheme(theme); }\n    public setCustomTheme(theme: ThemeConfig) { themeManager.setCustomTheme(theme); }\n\n    private init() {\n        this.container.innerHTML = '';\n        this.wrapper = document.createElement('div');\n        this.wrapper.className = 'bim-engine-wrapper';\n        this.container.appendChild(this.wrapper);\n\n        // 初始化管理器\n        this.dialog = new DialogManager(this.wrapper);\n        this.toolbar = new ToolbarManager(this.wrapper);\n        this.buttonGroup = new ButtonGroupManager(this.wrapper);\n\n        // --- 创建左上角按钮组 (需求 1 & 2) ---\n        this.createTopLeftGroup();\n\n        // 初始主题\n        this.updateTheme(themeManager.getTheme());\n\n        // 在主题更新后，设置左上角按钮组的自定义颜色\n        if (this.topLeftGroup) {\n            this.topLeftGroup.setColors({\n                backgroundColor: '#ff00ff'\n            });\n        }\n        themeManager.subscribe((theme) => {\n            this.updateTheme(theme);\n        });\n    }\n\n    private createTopLeftGroup() {\n        if (!this.buttonGroup) return;\n\n        this.topLeftGroup = this.buttonGroup.create({\n            position: 'top-left',\n            direction: 'column',\n            align: 'vertical',\n            backgroundColor: '#ff00ff', // 自定义背景色，不会被主题覆盖\n            showLabel: false\n        });\n\n        this.topLeftGroup.addGroup('main');\n        this.topLeftGroup.addButton({\n            id: 'menu-btn',\n            groupId: 'main',\n            type: 'button',\n            label: 'Menu', // 应该用 translation key\n            icon: '<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z\"/></svg>',\n            onClick: () => {\n                alert(\"点击按钮\")\n            }\n        });\n\n        // 手动 render 一次以显示\n        this.topLeftGroup.render();\n    }\n\n    private updateTheme(theme: ThemeConfig) {\n        if (this.wrapper) {\n            this.wrapper.style.backgroundColor = theme.background;\n            this.wrapper.style.color = theme.textPrimary;\n        }\n    }\n\n    public destroy() {\n        this.toolbar?.destroy();\n        this.buttonGroup?.destroy();\n        this.dialog = null;\n        this.container.innerHTML = '';\n    }\n}\n"],"names":["zhCN","enUS","LocaleManager","locale","key","keys","value","k","listener","l","localeManager","t","darkTheme","lightTheme","ThemeManager","themeName","theme","themeManager","BimButtonGroup","options","el","pos","style","margin","themeColors","colorKey","colors","groupId","beforeGroupId","g","newGroup","index","config","parentId","group","button","parentBtn","buttons","id","btn","found","groupElement","total","groupEl","btnWrapper","wrapper","btnEl","iconSize","minWidth","icon","textWrapper","label","arrow","dropdown","btnRect","expand","subBtn","item","dropdownRect","e","buttonId","visible","show","color","Toolbar","homeButton","locationButton","walkMenuButton","walkPersonButton","walkBirdButton","settingButton","infoButton","ToolbarManager","container","v","ButtonGroupManager","groupContainer","BimDialog","titleEl","header","title","closeBtn","content","resizeHandle","width","height","elRect","left","top","pW","pH","elW","elH","startX","startY","startLeft","startTop","onMouseDown","onMouseMove","onMouseUp","dx","dy","newLeft","newTop","maxLeft","maxTop","handle","startW","startH","newW","newH","BimInfoDialog","contentEl","infoTitle","infoList","actionBtn","DialogManager","dialog","d","BimEngine"],"mappings":"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"}